/**
 * Create fund_snapshots.csv from aggregated holdings data
 */

import { writeFileSync } from 'fs';

const data = [{"snapshot_date":"2025-09-18","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"181.03300000","total_cost_basis":"7061.40","total_market_value":"7076.99","avg_price":"39.0922514000000000"},{"snapshot_date":"2025-09-19","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"181.03300000","total_cost_basis":"7061.40","total_market_value":"7109.99","avg_price":"39.2745714800000000"},{"snapshot_date":"2025-09-22","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"181.03300000","total_cost_basis":"7061.40","total_market_value":"7144.63","avg_price":"39.4658791800000000"},{"snapshot_date":"2025-09-22","fund":"DES","total_shares":"0.59057000","total_cost_basis":"20.03","total_market_value":"20.09","avg_price":"34.0200000000000000"},{"snapshot_date":"2025-09-22","fund":"QQQM","total_shares":"0.21698000","total_cost_basis":"53.47","total_market_value":"53.79","avg_price":"247.9000000000000000"},{"snapshot_date":"2025-09-22","fund":"SCHD","total_shares":"0.44058000","total_cost_basis":"12.01","total_market_value":"12.01","avg_price":"27.2500000000000000"},{"snapshot_date":"2025-09-22","fund":"VTI","total_shares":"1.09977000","total_cost_basis":"360.48","total_market_value":"362.77","avg_price":"329.8600000000000000"},{"snapshot_date":"2025-09-23","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"181.03300000","total_cost_basis":"7061.40","total_market_value":"7107.20","avg_price":"39.2591641500000000"},{"snapshot_date":"2025-09-23","fund":"DES","total_shares":"0.59057000","total_cost_basis":"20.03","total_market_value":"20.13","avg_price":"34.0800000000000000"},{"snapshot_date":"2025-09-23","fund":"QQQM","total_shares":"0.21698000","total_cost_basis":"53.47","total_market_value":"53.43","avg_price":"246.2500000000000000"},{"snapshot_date":"2025-09-23","fund":"SCHD","total_shares":"0.44058000","total_cost_basis":"12.01","total_market_value":"12.07","avg_price":"27.4000000000000000"},{"snapshot_date":"2025-09-23","fund":"VTI","total_shares":"1.11801000","total_cost_basis":"366.50","total_market_value":"366.81","avg_price":"328.0900000000000000"},{"snapshot_date":"2025-09-24","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"184.44000000","total_cost_basis":"7194.40","total_market_value":"7216.81","avg_price":"39.1282018400000000"},{"snapshot_date":"2025-09-24","fund":"DES","total_shares":"0.70294000","total_cost_basis":"23.87","total_market_value":"23.83","avg_price":"33.9000000000000000"},{"snapshot_date":"2025-09-24","fund":"QQQM","total_shares":"0.21362000","total_cost_basis":"52.64","total_market_value":"52.42","avg_price":"245.3900000000000000"},{"snapshot_date":"2025-09-24","fund":"SCHD","total_shares":"1.03413000","total_cost_basis":"28.19","total_market_value":"28.09","avg_price":"27.1600000000000000"},{"snapshot_date":"2025-09-24","fund":"VTI","total_shares":"1.44394000","total_cost_basis":"473.56","total_market_value":"472.01","avg_price":"326.8900000000000000"},{"snapshot_date":"2025-09-25","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"184.44000000","total_cost_basis":"7194.40","total_market_value":"7182.36","avg_price":"38.9413879400000000"},{"snapshot_date":"2025-09-25","fund":"DES","total_shares":"0.70294000","total_cost_basis":"23.87","total_market_value":"23.60","avg_price":"33.5700000000000000"},{"snapshot_date":"2025-09-25","fund":"QQQM","total_shares":"0.22225000","total_cost_basis":"54.73","total_market_value":"54.30","avg_price":"244.3300000000000000"},{"snapshot_date":"2025-09-25","fund":"SCHD","total_shares":"1.03413000","total_cost_basis":"28.19","total_market_value":"27.91","avg_price":"26.9900000000000000"},{"snapshot_date":"2025-09-25","fund":"VTI","total_shares":"1.49856000","total_cost_basis":"491.24","total_market_value":"487.24","avg_price":"325.1400000000000000"},{"snapshot_date":"2025-09-26","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"184.44000000","total_cost_basis":"7194.40","total_market_value":"7224.62","avg_price":"39.1705720000000000"},{"snapshot_date":"2025-09-26","fund":"DES","total_shares":"0.70294000","total_cost_basis":"23.87","total_market_value":"23.79","avg_price":"33.8400000000000000"},{"snapshot_date":"2025-09-26","fund":"QQQM","total_shares":"0.22225000","total_cost_basis":"54.73","total_market_value":"54.53","avg_price":"245.3700000000000000"},{"snapshot_date":"2025-09-26","fund":"SCHD","total_shares":"1.03413000","total_cost_basis":"28.19","total_market_value":"28.14","avg_price":"27.2100000000000000"},{"snapshot_date":"2025-09-26","fund":"VTI","total_shares":"1.49856000","total_cost_basis":"491.24","total_market_value":"490.30","avg_price":"327.1800000000000000"},{"snapshot_date":"2025-09-29","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"181.03300000","total_cost_basis":"7061.40","total_market_value":"7224.27","avg_price":"39.1686460800000000"},{"snapshot_date":"2025-09-29","fund":"DES","total_shares":"0.70294000","total_cost_basis":"23.87","total_market_value":"23.65","avg_price":"33.6500000000000000"},{"snapshot_date":"2025-09-29","fund":"QQQM","total_shares":"0.22225000","total_cost_basis":"54.73","total_market_value":"54.78","avg_price":"246.4800000000000000"},{"snapshot_date":"2025-09-29","fund":"SCHD","total_shares":"1.03413000","total_cost_basis":"28.19","total_market_value":"28.02","avg_price":"27.1000000000000000"},{"snapshot_date":"2025-09-29","fund":"VTI","total_shares":"1.49856000","total_cost_basis":"491.24","total_market_value":"490.18","avg_price":"327.1000000000000000"},{"snapshot_date":"2025-09-30","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"184.44000000","total_cost_basis":"7194.40","total_market_value":"7250.91","avg_price":"39.3130898100000000"},{"snapshot_date":"2025-09-30","fund":"DES","total_shares":"0.70294000","total_cost_basis":"23.87","total_market_value":"23.68","avg_price":"33.6800000000000000"},{"snapshot_date":"2025-09-30","fund":"QQQM","total_shares":"0.22225000","total_cost_basis":"54.73","total_market_value":"54.92","avg_price":"247.1200000000000000"},{"snapshot_date":"2025-09-30","fund":"SCHD","total_shares":"1.03413000","total_cost_basis":"28.19","total_market_value":"28.23","avg_price":"27.3000000000000000"},{"snapshot_date":"2025-09-30","fund":"VTI","total_shares":"1.49856000","total_cost_basis":"491.24","total_market_value":"491.78","avg_price":"328.1700000000000000"},{"snapshot_date":"2025-10-01","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"184.26100000","total_cost_basis":"7187.41","total_market_value":"7269.78","avg_price":"39.4536817100000000"},{"snapshot_date":"2025-10-01","fund":"DES","total_shares":"0.77245000","total_cost_basis":"26.21","total_market_value":"26.03","avg_price":"33.7000000000000000"},{"snapshot_date":"2025-10-01","fund":"QQQM","total_shares":"0.23211000","total_cost_basis":"57.16","total_market_value":"57.64","avg_price":"248.3300000000000000"},{"snapshot_date":"2025-10-01","fund":"SCHD","total_shares":"1.11496000","total_cost_basis":"30.40","total_market_value":"30.69","avg_price":"27.5300000000000000"},{"snapshot_date":"2025-10-01","fund":"VTI","total_shares":"1.57066000","total_cost_basis":"514.86","total_market_value":"517.23","avg_price":"329.3100000000000000"},{"snapshot_date":"2025-10-02","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"184.26100000","total_cost_basis":"7187.41","total_market_value":"7277.81","avg_price":"39.4973358200000000"},{"snapshot_date":"2025-10-02","fund":"DES","total_shares":"0.77245000","total_cost_basis":"26.21","total_market_value":"25.96","avg_price":"33.6100000000000000"},{"snapshot_date":"2025-10-02","fund":"QQQM","total_shares":"0.23661000","total_cost_basis":"58.28","total_market_value":"58.99","avg_price":"249.3300000000000000"},{"snapshot_date":"2025-10-02","fund":"SCHD","total_shares":"1.11496000","total_cost_basis":"30.40","total_market_value":"30.48","avg_price":"27.3400000000000000"},{"snapshot_date":"2025-10-02","fund":"VTI","total_shares":"1.61116000","total_cost_basis":"528.22","total_market_value":"531.34","avg_price":"329.7900000000000000"},{"snapshot_date":"2025-10-03","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"184.26100000","total_cost_basis":"7187.41","total_market_value":"7278.42","avg_price":"39.5005456800000000"},{"snapshot_date":"2025-10-03","fund":"DES","total_shares":"0.82870000","total_cost_basis":"28.12","total_market_value":"28.00","avg_price":"33.7900000000000000"},{"snapshot_date":"2025-10-03","fund":"QQQM","total_shares":"0.24594000","total_cost_basis":"60.61","total_market_value":"61.07","avg_price":"248.3200000000000000"},{"snapshot_date":"2025-10-03","fund":"SCHD","total_shares":"1.19622000","total_cost_basis":"32.63","total_market_value":"32.79","avg_price":"27.4100000000000000"},{"snapshot_date":"2025-10-03","fund":"VTI","total_shares":"1.67291000","total_cost_basis":"548.64","total_market_value":"552.01","avg_price":"329.9700000000000000"},{"snapshot_date":"2025-10-06","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"184.26100000","total_cost_basis":"7187.41","total_market_value":"7303.25","avg_price":"39.6353598300000000"},{"snapshot_date":"2025-10-06","fund":"DES","total_shares":"0.82870000","total_cost_basis":"28.12","total_market_value":"27.97","avg_price":"33.7500000000000000"},{"snapshot_date":"2025-10-06","fund":"QQQM","total_shares":"0.24594000","total_cost_basis":"60.61","total_market_value":"61.53","avg_price":"250.1700000000000000"},{"snapshot_date":"2025-10-06","fund":"SCHD","total_shares":"1.19622000","total_cost_basis":"32.63","total_market_value":"32.70","avg_price":"27.3400000000000000"},{"snapshot_date":"2025-10-06","fund":"VTI","total_shares":"1.67291000","total_cost_basis":"548.64","total_market_value":"554.08","avg_price":"331.2100000000000000"},{"snapshot_date":"2025-10-07","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"184.26100000","total_cost_basis":"7187.41","total_market_value":"7277.22","avg_price":"39.4941259500000000"},{"snapshot_date":"2025-10-07","fund":"DES","total_shares":"0.82870000","total_cost_basis":"28.12","total_market_value":"27.75","avg_price":"33.4900000000000000"},{"snapshot_date":"2025-10-07","fund":"QQQM","total_shares":"0.24594000","total_cost_basis":"60.61","total_market_value":"61.20","avg_price":"248.8500000000000000"},{"snapshot_date":"2025-10-07","fund":"SCHD","total_shares":"1.19622000","total_cost_basis":"32.63","total_market_value":"32.63","avg_price":"27.2800000000000000"},{"snapshot_date":"2025-10-07","fund":"VTI","total_shares":"1.67291000","total_cost_basis":"548.64","total_market_value":"551.42","avg_price":"329.6200000000000000"},{"snapshot_date":"2025-10-08","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"184.26100000","total_cost_basis":"7187.41","total_market_value":"7319.46","avg_price":"39.7233100100000000"},{"snapshot_date":"2025-10-08","fund":"DES","total_shares":"0.82870000","total_cost_basis":"28.12","total_market_value":"27.78","avg_price":"33.5200000000000000"},{"snapshot_date":"2025-10-08","fund":"QQQM","total_shares":"0.24594000","total_cost_basis":"60.61","total_market_value":"61.91","avg_price":"251.7100000000000000"},{"snapshot_date":"2025-10-08","fund":"SCHD","total_shares":"1.19622000","total_cost_basis":"32.63","total_market_value":"32.51","avg_price":"27.1800000000000000"},{"snapshot_date":"2025-10-08","fund":"VTI","total_shares":"1.67291000","total_cost_basis":"548.64","total_market_value":"555.09","avg_price":"331.8100000000000000"},{"snapshot_date":"2025-10-09","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"184.26100000","total_cost_basis":"7187.41","total_market_value":"7299.70","avg_price":"39.6161006600000000"},{"snapshot_date":"2025-10-09","fund":"DES","total_shares":"0.82870000","total_cost_basis":"28.12","total_market_value":"27.50","avg_price":"33.1900000000000000"},{"snapshot_date":"2025-10-09","fund":"QQQM","total_shares":"0.24594000","total_cost_basis":"60.61","total_market_value":"61.83","avg_price":"251.4100000000000000"},{"snapshot_date":"2025-10-09","fund":"SCHD","total_shares":"1.19622000","total_cost_basis":"32.63","total_market_value":"32.30","avg_price":"27.0000000000000000"},{"snapshot_date":"2025-10-09","fund":"VTI","total_shares":"1.67291000","total_cost_basis":"548.64","total_market_value":"553.16","avg_price":"330.6600000000000000"},{"snapshot_date":"2025-10-10","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"184.26100000","total_cost_basis":"7187.41","total_market_value":"7103.46","avg_price":"38.5510688800000000"},{"snapshot_date":"2025-10-10","fund":"DES","total_shares":"0.82870000","total_cost_basis":"28.12","total_market_value":"26.78","avg_price":"32.3200000000000000"},{"snapshot_date":"2025-10-10","fund":"QQQM","total_shares":"0.24594000","total_cost_basis":"60.61","total_market_value":"59.68","avg_price":"242.6700000000000000"},{"snapshot_date":"2025-10-10","fund":"SCHD","total_shares":"1.19622000","total_cost_basis":"32.63","total_market_value":"31.75","avg_price":"26.5400000000000000"},{"snapshot_date":"2025-10-10","fund":"VTI","total_shares":"1.67291000","total_cost_basis":"548.64","total_market_value":"538.34","avg_price":"321.8000000000000000"},{"snapshot_date":"2025-10-13","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"184.26100000","total_cost_basis":"7187.41","total_market_value":"7211.10","avg_price":"39.1352635300000000"},{"snapshot_date":"2025-10-13","fund":"DES","total_shares":"0.87130000","total_cost_basis":"29.52","total_market_value":"28.67","avg_price":"32.9100000000000000"},{"snapshot_date":"2025-10-13","fund":"QQQM","total_shares":"0.25401000","total_cost_basis":"62.61","total_market_value":"62.95","avg_price":"247.8300000000000000"},{"snapshot_date":"2025-10-13","fund":"SCHD","total_shares":"1.26191000","total_cost_basis":"34.38","total_market_value":"33.60","avg_price":"26.6300000000000000"},{"snapshot_date":"2025-10-13","fund":"VTI","total_shares":"1.73372000","total_cost_basis":"568.51","total_market_value":"566.81","avg_price":"326.9300000000000000"},{"snapshot_date":"2025-10-14","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"187.58400000","total_cost_basis":"7317.28","total_market_value":"7330.79","avg_price":"39.0800539300000000"},{"snapshot_date":"2025-10-14","fund":"DES","total_shares":"0.87130000","total_cost_basis":"29.52","total_market_value":"29.23","avg_price":"33.5500000000000000"},{"snapshot_date":"2025-10-14","fund":"QQQM","total_shares":"0.26410000","total_cost_basis":"65.07","total_market_value":"65.02","avg_price":"246.2100000000000000"},{"snapshot_date":"2025-10-14","fund":"SCHD","total_shares":"1.30296000","total_cost_basis":"35.47","total_market_value":"35.01","avg_price":"26.8700000000000000"},{"snapshot_date":"2025-10-14","fund":"VTI","total_shares":"1.79702000","total_cost_basis":"588.95","total_market_value":"587.32","avg_price":"326.8300000000000000"},{"snapshot_date":"2025-10-15","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"187.58400000","total_cost_basis":"7317.28","total_market_value":"7363.07","avg_price":"39.2521024600000000"},{"snapshot_date":"2025-10-15","fund":"DES","total_shares":"0.92362000","total_cost_basis":"31.27","total_market_value":"30.94","avg_price":"33.5000000000000000"},{"snapshot_date":"2025-10-15","fund":"QQQM","total_shares":"0.27370000","total_cost_basis":"67.45","total_market_value":"67.84","avg_price":"247.8800000000000000"},{"snapshot_date":"2025-10-15","fund":"SCHD","total_shares":"1.35261000","total_cost_basis":"36.80","total_market_value":"36.22","avg_price":"26.7800000000000000"},{"snapshot_date":"2025-10-15","fund":"VTI","total_shares":"1.85956000","total_cost_basis":"609.48","total_market_value":"610.64","avg_price":"328.3800000000000000"},{"snapshot_date":"2025-10-16","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"187.58400000","total_cost_basis":"7317.28","total_market_value":"7314.42","avg_price":"38.9927457100000000"},{"snapshot_date":"2025-10-16","fund":"DES","total_shares":"0.99229000","total_cost_basis":"33.53","total_market_value":"32.67","avg_price":"32.9200000000000000"},{"snapshot_date":"2025-10-16","fund":"QQQM","total_shares":"0.29133000","total_cost_basis":"71.80","total_market_value":"71.96","avg_price":"247.0000000000000000"},{"snapshot_date":"2025-10-16","fund":"SCHD","total_shares":"1.44524000","total_cost_basis":"39.26","total_market_value":"38.40","avg_price":"26.5700000000000000"},{"snapshot_date":"2025-10-16","fund":"VTI","total_shares":"1.98519000","total_cost_basis":"650.42","total_market_value":"646.72","avg_price":"325.7700000000000000"},{"snapshot_date":"2025-10-17","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"187.58400000","total_cost_basis":"7317.28","total_market_value":"7354.99","avg_price":"39.2090903300000000"},{"snapshot_date":"2025-10-17","fund":"DES","total_shares":"1.02256000","total_cost_basis":"34.53","total_market_value":"33.78","avg_price":"33.0300000000000000"},{"snapshot_date":"2025-10-17","fund":"QQQM","total_shares":"0.30071000","total_cost_basis":"74.11","total_market_value":"74.76","avg_price":"248.6100000000000000"},{"snapshot_date":"2025-10-17","fund":"SCHD","total_shares":"1.48349000","total_cost_basis":"40.28","total_market_value":"39.74","avg_price":"26.7900000000000000"},{"snapshot_date":"2025-10-17","fund":"VTI","total_shares":"2.04875000","total_cost_basis":"671.08","total_market_value":"670.56","avg_price":"327.3000000000000000"},{"snapshot_date":"2025-10-20","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"187.58400000","total_cost_basis":"7317.28","total_market_value":"7432.19","avg_price":"39.6205944700000000"},{"snapshot_date":"2025-10-20","fund":"DES","total_shares":"1.02256000","total_cost_basis":"34.53","total_market_value":"34.31","avg_price":"33.5500000000000000"},{"snapshot_date":"2025-10-20","fund":"QQQM","total_shares":"0.30071000","total_cost_basis":"74.11","total_market_value":"75.71","avg_price":"251.7600000000000000"},{"snapshot_date":"2025-10-20","fund":"SCHD","total_shares":"1.48349000","total_cost_basis":"40.28","total_market_value":"40.04","avg_price":"26.9900000000000000"},{"snapshot_date":"2025-10-20","fund":"VTI","total_shares":"2.04875000","total_cost_basis":"671.08","total_market_value":"678.03","avg_price":"330.9500000000000000"},{"snapshot_date":"2025-10-21","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"191.39100000","total_cost_basis":"7468.08","total_market_value":"7582.04","avg_price":"39.6154586900000000"},{"snapshot_date":"2025-10-21","fund":"DES","total_shares":"1.02256000","total_cost_basis":"34.53","total_market_value":"34.29","avg_price":"33.5300000000000000"},{"snapshot_date":"2025-10-21","fund":"QQQM","total_shares":"0.30071000","total_cost_basis":"74.11","total_market_value":"75.69","avg_price":"251.6900000000000000"},{"snapshot_date":"2025-10-21","fund":"SCHD","total_shares":"1.48349000","total_cost_basis":"40.28","total_market_value":"40.16","avg_price":"27.0700000000000000"},{"snapshot_date":"2025-10-21","fund":"VTI","total_shares":"2.04875000","total_cost_basis":"671.08","total_market_value":"677.95","avg_price":"330.9100000000000000"},{"snapshot_date":"2025-10-22","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"191.39100000","total_cost_basis":"7468.08","total_market_value":"7543.71","avg_price":"39.4151633800000000"},{"snapshot_date":"2025-10-22","fund":"DES","total_shares":"1.02256000","total_cost_basis":"34.53","total_market_value":"34.29","avg_price":"33.5300000000000000"},{"snapshot_date":"2025-10-22","fund":"QQQM","total_shares":"0.30598000","total_cost_basis":"75.42","total_market_value":"76.27","avg_price":"249.2600000000000000"},{"snapshot_date":"2025-10-22","fund":"SCHD","total_shares":"1.48349000","total_cost_basis":"40.28","total_market_value":"40.04","avg_price":"26.9900000000000000"},{"snapshot_date":"2025-10-22","fund":"VTI","total_shares":"2.08458000","total_cost_basis":"682.86","total_market_value":"685.62","avg_price":"328.9000000000000000"},{"snapshot_date":"2025-10-23","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"191.39100000","total_cost_basis":"7468.08","total_market_value":"7586.35","avg_price":"39.6379277100000000"},{"snapshot_date":"2025-10-23","fund":"DES","total_shares":"1.02256000","total_cost_basis":"34.53","total_market_value":"34.40","avg_price":"33.6400000000000000"},{"snapshot_date":"2025-10-23","fund":"QQQM","total_shares":"0.30598000","total_cost_basis":"75.42","total_market_value":"76.92","avg_price":"251.3900000000000000"},{"snapshot_date":"2025-10-23","fund":"SCHD","total_shares":"1.48349000","total_cost_basis":"40.28","total_market_value":"40.10","avg_price":"27.0300000000000000"},{"snapshot_date":"2025-10-23","fund":"VTI","total_shares":"2.08458000","total_cost_basis":"682.86","total_market_value":"690.02","avg_price":"331.0100000000000000"},{"snapshot_date":"2025-10-24","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"191.39100000","total_cost_basis":"7468.08","total_market_value":"7649.13","avg_price":"39.9659754800000000"},{"snapshot_date":"2025-10-24","fund":"DES","total_shares":"1.02256000","total_cost_basis":"34.53","total_market_value":"34.65","avg_price":"33.8900000000000000"},{"snapshot_date":"2025-10-24","fund":"QQQM","total_shares":"0.30598000","total_cost_basis":"75.42","total_market_value":"77.73","avg_price":"254.0200000000000000"},{"snapshot_date":"2025-10-24","fund":"SCHD","total_shares":"1.48349000","total_cost_basis":"40.28","total_market_value":"40.10","avg_price":"27.0300000000000000"},{"snapshot_date":"2025-10-24","fund":"VTI","total_shares":"2.08458000","total_cost_basis":"682.86","total_market_value":"695.65","avg_price":"333.7100000000000000"},{"snapshot_date":"2025-10-27","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"191.39100000","total_cost_basis":"7468.08","total_market_value":"7740.67","avg_price":"40.4442447200000000"},{"snapshot_date":"2025-10-27","fund":"DES","total_shares":"1.02256000","total_cost_basis":"34.53","total_market_value":"34.50","avg_price":"33.7400000000000000"},{"snapshot_date":"2025-10-27","fund":"QQQM","total_shares":"0.30598000","total_cost_basis":"75.42","total_market_value":"79.12","avg_price":"258.5800000000000000"},{"snapshot_date":"2025-10-27","fund":"SCHD","total_shares":"1.48349000","total_cost_basis":"40.28","total_market_value":"40.23","avg_price":"27.1200000000000000"},{"snapshot_date":"2025-10-27","fund":"VTI","total_shares":"2.08458000","total_cost_basis":"682.86","total_market_value":"703.40","avg_price":"337.4300000000000000"},{"snapshot_date":"2025-10-28","fund":"0899 Vanguard 500 Index Fund Adm","total_shares":"191.39100000","total_cost_basis":"7468.08","total_market_value":"7763.76","avg_price":"40.5649000000000000"},{"snapshot_date":"2025-10-28","fund":"DES","total_shares":"1.02256000","total_cost_basis":"34.53","total_market_value":"34.16","avg_price":"33.4100000000000000"},{"snapshot_date":"2025-10-28","fund":"QQQM","total_shares":"0.30598000","total_cost_basis":"75.42","total_market_value":"79.79","avg_price":"260.7650000000000000"},{"snapshot_date":"2025-10-28","fund":"SCHD","total_shares":"1.48349000","total_cost_basis":"40.28","total_market_value":"40.07","avg_price":"27.0100000000000000"},{"snapshot_date":"2025-10-28","fund":"VTI","total_shares":"2.08458000","total_cost_basis":"682.86","total_market_value":"704.71","avg_price":"338.0600000000000000"}];

const now = new Date().toISOString();

// CSV header
const headers = [
  'snapshot_date',
  'snapshot_time',
  'ticker',
  'fund_name',
  'shares',
  'cost_basis',
  'market_value',
  'avg_cost_per_share',
  'current_price',
  'gain_loss',
  'gain_loss_percent',
  'created_at'
];

// Map fund name to ticker (for Voya fund specifically)
function getTicker(fundName) {
  if (fundName.includes('0899')) {
    return 'VOYA_0899';
  }
  return fundName;
}

// Convert data to CSV rows
const rows = data.map(row => {
  const shares = parseFloat(row.total_shares);
  const costBasis = parseFloat(row.total_cost_basis);
  const marketValue = parseFloat(row.total_market_value);
  const price = parseFloat(row.avg_price);
  const avgCostPerShare = shares > 0 ? costBasis / shares : 0;
  const gainLoss = marketValue - costBasis;
  const gainLossPercent = costBasis > 0 ? (gainLoss / costBasis) * 100 : 0;

  const ticker = getTicker(row.fund);

  return [
    row.snapshot_date,
    now,
    ticker,
    row.fund,
    shares.toFixed(8),
    costBasis.toFixed(2),
    marketValue.toFixed(2),
    avgCostPerShare.toFixed(8),
    price.toFixed(8),
    gainLoss.toFixed(2),
    gainLossPercent.toFixed(4),
    now
  ].join(',');
});

// Create CSV
const csv = [headers.join(','), ...rows].join('\n');

// Write to file
writeFileSync('fund_snapshots.csv', csv, 'utf-8');

console.log(`✅ Generated fund_snapshots.csv with ${rows.length} records`);
console.log(`\n📝 To import:`);
console.log(`   1. Go to Supabase dashboard`);
console.log(`   2. Open the fund_snapshots table`);
console.log(`   3. Click "Insert" → "Import data from CSV"`);
console.log(`   4. Upload fund_snapshots.csv`);
console.log(`   5. Deselect "id" and "created_at" columns (they will auto-generate)`);
console.log(`   6. Match remaining columns and import\n`);
